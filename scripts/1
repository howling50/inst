#! /bin/bash
sudo umount /.snapshots
sudo rm -rf /.snapshots
sudo snapper -c root create-config /
sudo sed -i 's/^ALLOW_USERS=""/ALLOW_USERS="howling"/' /etc/snapper/configs/root
sudo sed -i 's/^TIMELINE_LIMIT_HOURLY="10"/TIMELINE_LIMIT_HOURLY="0"/' /etc/snapper/configs/root
sudo sed -i 's/^TIMELINE_LIMIT_DAILY="10"/TIMELINE_LIMIT_DAILY="4"/' /etc/snapper/configs/root
sudo sed -i 's/^TIMELINE_LIMIT_WEEKLY="0"/TIMELINE_LIMIT_WEEKLY="2"/' /etc/snapper/configs/root
sudo sed -i 's/^TIMELINE_LIMIT_MONTHLY="10"/TIMELINE_LIMIT_MONTHLY="1"/' /etc/snapper/configs/root
sudo sed -i 's/^TIMELINE_LIMIT_YEARLY="10"/TIMELINE_LIMIT_YEARLY="0"/' /etc/snapper/configs/root
sudo btrfs subvolume delete /.snapshots
sudo mkdir /.snapshots
sudo mkdir /mnt/btrfs
sudo mount /dev/sda2 /mnt/btrfs
sudo btrfs subvolume create /mnt/btrfs/snapshots
sudo chmod a+rx /.snapshots/
sudo umount /mnt/btrfs

#replace uuid from id u get fromm /etc/fstab
sudo bash -c 'echo "UUID=cb4d77df-3e6a-4179-a881-df7c85f4b7c9 /.snapshots     btrfs   subvol=snapshots 0 0" >> /etc/fstab'

sudo mount -a
sudo btrfs subvolume get-default /

# sudo btrfs subv list / get the id of root
sudo btrfs subvolume set-default 256 /

sudo btrfs subvolume get-default /
#sudo nano /boot/grub/grub.cfg
#removeall = rootflags=subvol=@  
#sudo snapper rollback 2
#sudo snapper --ambit classic rollback 2

#sudo snapper -c root create-config / 
#snapper status 21..22
#sudo btrfs subvolume list /
#snapper list
#snapper delete
#snapper diff 71..72 /etc/zypp/zypp.conf
#snapper create --description "Snapshot for week 2 2014"
